<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>执行机制 | 前端</title>
    <meta name="description" content="春江花月夜的前端仓库">
    <link rel="icon" href="/Prebook/favicon.ico">
    
    <link rel="preload" href="/Prebook/assets/css/0.styles.7c675de5.css" as="style"><link rel="preload" href="/Prebook/assets/js/app.9e47b049.js" as="script"><link rel="preload" href="/Prebook/assets/js/2.7ad09ebd.js" as="script"><link rel="preload" href="/Prebook/assets/js/23.0a852139.js" as="script"><link rel="prefetch" href="/Prebook/assets/js/10.b3132b99.js"><link rel="prefetch" href="/Prebook/assets/js/11.0c733b44.js"><link rel="prefetch" href="/Prebook/assets/js/12.f7b6670d.js"><link rel="prefetch" href="/Prebook/assets/js/13.decd372f.js"><link rel="prefetch" href="/Prebook/assets/js/14.ed159846.js"><link rel="prefetch" href="/Prebook/assets/js/15.b8e414eb.js"><link rel="prefetch" href="/Prebook/assets/js/16.e334efdd.js"><link rel="prefetch" href="/Prebook/assets/js/17.a62cd895.js"><link rel="prefetch" href="/Prebook/assets/js/18.b83405a7.js"><link rel="prefetch" href="/Prebook/assets/js/19.232034ad.js"><link rel="prefetch" href="/Prebook/assets/js/20.22e7e3a8.js"><link rel="prefetch" href="/Prebook/assets/js/21.b84b9a5d.js"><link rel="prefetch" href="/Prebook/assets/js/22.ed7eb985.js"><link rel="prefetch" href="/Prebook/assets/js/24.09a05518.js"><link rel="prefetch" href="/Prebook/assets/js/25.077f0015.js"><link rel="prefetch" href="/Prebook/assets/js/26.a5e7ce69.js"><link rel="prefetch" href="/Prebook/assets/js/27.2fa36787.js"><link rel="prefetch" href="/Prebook/assets/js/28.e347c05b.js"><link rel="prefetch" href="/Prebook/assets/js/29.4dca8ecd.js"><link rel="prefetch" href="/Prebook/assets/js/3.c69347f7.js"><link rel="prefetch" href="/Prebook/assets/js/30.edf00438.js"><link rel="prefetch" href="/Prebook/assets/js/31.4a69633d.js"><link rel="prefetch" href="/Prebook/assets/js/32.9877c19d.js"><link rel="prefetch" href="/Prebook/assets/js/33.483b4a2e.js"><link rel="prefetch" href="/Prebook/assets/js/34.a048e929.js"><link rel="prefetch" href="/Prebook/assets/js/35.82ed7e12.js"><link rel="prefetch" href="/Prebook/assets/js/36.ff30a8b2.js"><link rel="prefetch" href="/Prebook/assets/js/37.f4cbcdbd.js"><link rel="prefetch" href="/Prebook/assets/js/38.3e558f36.js"><link rel="prefetch" href="/Prebook/assets/js/39.e09d3663.js"><link rel="prefetch" href="/Prebook/assets/js/4.9917bcdf.js"><link rel="prefetch" href="/Prebook/assets/js/40.9bd4b4c1.js"><link rel="prefetch" href="/Prebook/assets/js/41.a14b15fe.js"><link rel="prefetch" href="/Prebook/assets/js/42.46bf4476.js"><link rel="prefetch" href="/Prebook/assets/js/43.7e77880e.js"><link rel="prefetch" href="/Prebook/assets/js/44.d4c19b1d.js"><link rel="prefetch" href="/Prebook/assets/js/45.38638ef2.js"><link rel="prefetch" href="/Prebook/assets/js/46.30847516.js"><link rel="prefetch" href="/Prebook/assets/js/47.6161cceb.js"><link rel="prefetch" href="/Prebook/assets/js/48.ec8729b6.js"><link rel="prefetch" href="/Prebook/assets/js/49.f6faa379.js"><link rel="prefetch" href="/Prebook/assets/js/5.b715e61e.js"><link rel="prefetch" href="/Prebook/assets/js/50.529d5d55.js"><link rel="prefetch" href="/Prebook/assets/js/51.139d0744.js"><link rel="prefetch" href="/Prebook/assets/js/52.f7369209.js"><link rel="prefetch" href="/Prebook/assets/js/53.0d05c274.js"><link rel="prefetch" href="/Prebook/assets/js/54.649626e6.js"><link rel="prefetch" href="/Prebook/assets/js/55.cce172eb.js"><link rel="prefetch" href="/Prebook/assets/js/56.3e53bc0d.js"><link rel="prefetch" href="/Prebook/assets/js/57.3d57d1c2.js"><link rel="prefetch" href="/Prebook/assets/js/58.14f9495b.js"><link rel="prefetch" href="/Prebook/assets/js/6.698da9e3.js"><link rel="prefetch" href="/Prebook/assets/js/7.a990dcfa.js"><link rel="prefetch" href="/Prebook/assets/js/8.b5480430.js"><link rel="prefetch" href="/Prebook/assets/js/9.dc616334.js">
    <link rel="stylesheet" href="/Prebook/assets/css/0.styles.7c675de5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Prebook/" class="home-link router-link-active"><!----> <span class="site-name">前端</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Prebook/" class="nav-link">前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cjhyy.github.io/myleetcode/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leetcode题解
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  数学
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  计算机
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  英语
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  日语
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  其他
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Prebook/" class="nav-link">前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cjhyy.github.io/myleetcode/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  leetcode题解
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  数学
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  计算机
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  英语
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  日语
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  其他
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/cjhyy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Javascript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Prebook/JavaScript/变量和类型.html" class="sidebar-link">变量和类型</a></li><li><a href="/Prebook/JavaScript/原型和原型链.html" class="sidebar-link">原型和原型链</a></li><li><a href="/Prebook/JavaScript/作用域和闭包.html" class="sidebar-link">作用域和闭包</a></li><li><a href="/Prebook/JavaScript/执行机制.html" class="active sidebar-link">执行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Prebook/JavaScript/执行机制.html#_1-为何try里面放return，finally还会执行，理解其内部机制" class="sidebar-link">1.为何try里面放return，finally还会执行，理解其内部机制</a></li><li class="sidebar-sub-header"><a href="/Prebook/JavaScript/执行机制.html#_2-javascript如何实现异步编程，可以详细描述eventloop机制" class="sidebar-link">2.JavaScript如何实现异步编程，可以详细描述EventLoop机制</a></li><li class="sidebar-sub-header"><a href="/Prebook/JavaScript/执行机制.html#_3-宏任务和微任务分别有哪些" class="sidebar-link">3.宏任务和微任务分别有哪些</a></li><li class="sidebar-sub-header"><a href="/Prebook/JavaScript/执行机制.html#_4-可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法" class="sidebar-link">4.可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法</a></li><li class="sidebar-sub-header"><a href="/Prebook/JavaScript/执行机制.html#_5-使用promise实现串行" class="sidebar-link">5.使用Promise实现串行</a></li><li class="sidebar-sub-header"><a href="/Prebook/JavaScript/执行机制.html#_6-node与浏览器eventloop的差异" class="sidebar-link">6.Node与浏览器EventLoop的差异</a></li><li class="sidebar-sub-header"><a href="/Prebook/JavaScript/执行机制.html#_7-如何在保证页面运行流畅的情况下处理海量数据" class="sidebar-link">7.如何在保证页面运行流畅的情况下处理海量数据</a></li></ul></li><li><a href="/Prebook/JavaScript/语法和API.html" class="sidebar-link">语法和API</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Html和Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运行环境</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="执行机制"><a href="#执行机制" aria-hidden="true" class="header-anchor">#</a> 执行机制</h1> <h2 id="_1-为何try里面放return，finally还会执行，理解其内部机制"><a href="#_1-为何try里面放return，finally还会执行，理解其内部机制" aria-hidden="true" class="header-anchor">#</a> 1.为何<code>try</code>里面放<code>return</code>，<code>finally</code>还会执行，理解其内部机制</h2> <h4 id="如果try语句里有return，那么代码的行为如下："><a href="#如果try语句里有return，那么代码的行为如下：" aria-hidden="true" class="header-anchor">#</a> 如果try语句里有return，那么代码的行为如下：</h4> <h5 id="_1-如果有返回值，就把返回值保存到局部变量中"><a href="#_1-如果有返回值，就把返回值保存到局部变量中" aria-hidden="true" class="header-anchor">#</a> 1.如果有返回值，就把返回值保存到局部变量中</h5> <h5 id="_2-跳到finally语句里执行"><a href="#_2-跳到finally语句里执行" aria-hidden="true" class="header-anchor">#</a> 2.跳到finally语句里执行</h5> <h5 id="_3-执行完finally语句后，返回之前保存在局部变量表里的值"><a href="#_3-执行完finally语句后，返回之前保存在局部变量表里的值" aria-hidden="true" class="header-anchor">#</a> 3.执行完finally语句后，返回之前保存在局部变量表里的值</h5> <h2 id="_2-javascript如何实现异步编程，可以详细描述eventloop机制"><a href="#_2-javascript如何实现异步编程，可以详细描述eventloop机制" aria-hidden="true" class="header-anchor">#</a> 2.<code>JavaScript</code>如何实现异步编程，可以详细描述<code>EventLoop</code>机制</h2> <h3 id="事件循环（event-loop）"><a href="#事件循环（event-loop）" aria-hidden="true" class="header-anchor">#</a> 事件循环（Event Loop）</h3> <p>JavaScript引擎负责解析，执行JavaScript代码，但它并不能单独运行，通常都得有一个宿主环境，一般如浏览器或Node服务器，前文说到的单线程是指在这些宿主环境创建单一线程，提供一种机制，调用JavaScript引擎完成多个JavaScript代码块的调度，执行（是的，JavaScript代码都是按块执行的），这种机制就称为事件循环（Event Loop）。</p> <p><strong>注</strong>：这里的事件与DOM事件不要混淆，可以说这里的事件包括DOM事件，所有异步操作都是一个事件，诸如ajax请求就可以看作一个request请求事件。</p> <h4 id="javascript执行环境中存在的两个结构需要了解："><a href="#javascript执行环境中存在的两个结构需要了解：" aria-hidden="true" class="header-anchor">#</a> JavaScript执行环境中存在的两个结构需要了解：</h4> <p>消息队列(message queue)，也叫任务队列（task queue）：存储待处理消息及对应的回调函数或事件处理程序；
执行栈(execution context stack)，也可以叫执行上下文栈：JavaScript执行栈，顾名思义，是由执行上下文组成，当函数调用时，创建并插入一个执行上下文，通常称为执行栈帧（frame），存储着函数参数和局部变量，当该函数执行结束时，弹出该执行栈帧；
<strong>注</strong>：关于全局代码，由于所有的代码都是在全局上下文执行，所以执行栈顶总是全局上下文就很容易理解，直到所有代码执行完毕，全局上下文退出执行栈，栈清空了；也即是全局上下文是第一个入栈，最后一个出栈。</p> <p>任务
分析事件循环流程前，先阐述两个概念，有助于理解事件循环：同步任务和异步任务。</p> <p>任务很好理解，JavaScript代码执行就是在完成任务，所谓任务就是一个函数或一个代码块，通常以功能或目的划分，比如完成一次加法计算，完成一次ajax请求；很自然的就分为同步任务和异步任务。同步任务是连续的，阻塞的；而异步任务则是不连续，非阻塞的，包含异步事件及其回调，当我们谈及执行异步任务时，通常指执行其回调函数。</p> <h4 id="事件循环流程"><a href="#事件循环流程" aria-hidden="true" class="header-anchor">#</a> 事件循环流程</h4> <p>关于事件循环流程分解如下：</p> <p>宿主环境为JavaScript创建线程时，会创建堆(heap)和栈(stack)，堆内存储JavaScript对象，栈内存储执行上下文；
栈内执行上下文的同步任务按序执行，执行完即退栈，而当异步任务执行时，该异步任务进入等待状态（不入栈），同时通知线程：当触发该事件时（或该异步操作响应返回时），需向消息队列插入一个事件消息；
当事件触发或响应返回时，线程向消息队列插入该事件消息（包含事件及回调）；
当栈内同步任务执行完毕后，线程从消息队列取出一个事件消息，其对应异步任务（函数）入栈，执行回调函数，如果未绑定回调，这个消息会被丢弃，执行完任务后退栈；
当线程空闲（即执行栈清空）时继续拉取消息队列下一轮消息（next tick，事件循环流转一次称为一次tick）。
使用代码可以描述如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> eventLoop <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> event<span class="token punctuation">;</span>
<span class="token keyword">var</span> i <span class="token operator">=</span> eventLoop<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 后进先出</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>eventLoop<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event <span class="token operator">=</span> eventLoop<span class="token punctuation">[</span>i<span class="token operator">--</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 事件回调存在</span>
        <span class="token function">event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 否则事件消息被丢弃</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这里注意的一点是等待下一个事件消息的过程是同步的。</p> <p>并发模型与事件循环</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> ele <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">clickCb</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clicked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ele<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>   

<span class="token function">bindEvent</span><span class="token punctuation">(</span>clickCb<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>针对如上代码我们可以构建如下并发模型：</p> <p><img src="http://blog.codingplayboy.com/wp-content/uploads/2017/04/concurrency-model.png" alt="JavaScriptå¹¶åæ¨¡å"></p> <p>如上图，当执行栈同步代码块依次执行完直到遇见异步任务时，异步任务进入等待状态，通知线程，异步事件触发时，往消息队列插入一条事件消息；而当执行栈后续同步代码执行完后，读取消息队列，得到一条消息，然后将该消息对应的异步任务入栈，执行回调函数；一次事件循环就完成了，也即处理了一个异步任务。</p> <h2 id="_3-宏任务和微任务分别有哪些"><a href="#_3-宏任务和微任务分别有哪些" aria-hidden="true" class="header-anchor">#</a> 3.宏任务和微任务分别有哪些</h2> <pre><code>宏任务包括：script(整体代码), setTimeout, setInterval, setImmediate, I/O, UI rendering。

微任务包括： Promises, Object.observe, MutationObserver
</code></pre> <h4 id="_1-宏任务macrotask："><a href="#_1-宏任务macrotask：" aria-hidden="true" class="header-anchor">#</a> 1.宏任务macrotask：</h4> <p>（事件队列中的每一个事件都是一个macrotask）</p> <p>优先级：主代码块 &gt; setImmediate &gt; MessageChannel &gt; setTimeout / setInterval</p> <h4 id="_2-微任务包括："><a href="#_2-微任务包括：" aria-hidden="true" class="header-anchor">#</a> 2.微任务包括：</h4> <p>优先级：process.nextTick &gt; Promise &gt; MutationObserver</p> <h4 id="_3-执行顺序"><a href="#_3-执行顺序" aria-hidden="true" class="header-anchor">#</a> 3.执行顺序</h4> <h2 id="_4-可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法"><a href="#_4-可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法" aria-hidden="true" class="header-anchor">#</a> 4.可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法</h2> <p><a href="https://juejin.im/post/5e58c618e51d4526ed66b5cf?utm_source=gold_browser_extension#heading-54" target="_blank" rel="noopener noreferrer">异步练习<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_5-使用promise实现串行"><a href="#_5-使用promise实现串行" aria-hidden="true" class="header-anchor">#</a> 5.使用<code>Promise</code>实现串行</h2> <h4 id="场景"><a href="#场景" aria-hidden="true" class="header-anchor">#</a> 场景</h4> <p>有a、b、c三个异步任务，要求必须先执行a，再执行b，最后执行c
且下一次任务必须要拿到上一次任务执行的结果，才能做操作</p> <h4 id="思路"><a href="#思路" aria-hidden="true" class="header-anchor">#</a> 思路</h4> <p>我们需要实现一个队列，将这些异步函数添加进队列并且管理它们的执行，队列具有First In First Out的特性，也就是先添加进去的会被先执行，接着才会执行下一个(注意跟栈作区别)
大家也可以类比一下jQuery的animate方法，添加多个动画也会按顺序执行</p> <h4 id="解决"><a href="#解决" aria-hidden="true" class="header-anchor">#</a> 解决</h4> <p>模拟3个异步函数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 异步函数a
var a = function () {
  return new Promise(function (resolve, reject) {
    setTimeout(function () {
      resolve('a')
    }, 1000)
  })
}

// 异步函数b
var b = function (data) {
  return new Promise(function (resolve, reject) {
    resolve(data + 'b')
  })
}

// 异步函数c
var c = function (data) {
  return new Promise(function (resolve, reject) {
    setTimeout(function () {
      resolve(data + 'c')
    }, 500)
  })
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="解决方法一-使用then链式操作"><a href="#解决方法一-使用then链式操作" aria-hidden="true" class="header-anchor">#</a> 解决方法一(使用then链式操作)</h4> <p>解决方法一(使用then链式操作)</p> <p>特点：可以满足需求，但是书写比较繁琐
代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//链式调用
a()
  .then(function (data) {
    return b(data)
  })
  .then(function (data) {
    return c(data)
  })
  .then(function (data) {
    console.log(data)// abc
  })
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="方法二-构建队列"><a href="#方法二-构建队列" aria-hidden="true" class="header-anchor">#</a> 方法二(构建队列)</h4> <p>方法二(构建队列)</p> <p>特点：封装方法，可移植到别处使用
代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 构建队列
function queue(arr) {
  var sequence = Promise.resolve()
  arr.forEach(function (item) {
    sequence = sequence.then(item)
  })
  return sequence
}

// 执行队列
queue([a, b, c])
  .then(data =&gt; {
    console.log(data)// abc
  })
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="方法三-使用async、await构建队列"><a href="#方法三-使用async、await构建队列" aria-hidden="true" class="header-anchor">#</a> 方法三(使用async、await构建队列)</h4> <p>方法三(使用async、await构建队列)</p> <p>同方法二，只是显得更高大上点
代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>async function queue(arr) {
  let res = null
  for (let promise of arr) {
    res = await promise(res)
  }
  return await res
}
queue([a, b, c])
  .then(data =&gt; {
    console.log(data)// abc })
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_6-node与浏览器eventloop的差异"><a href="#_6-node与浏览器eventloop的差异" aria-hidden="true" class="header-anchor">#</a> 6.<code>Node</code>与浏览器<code>EventLoop</code>的差异</h2> <p><strong>过程</strong>:<a href="https://blog.csdn.net/Fundebug/article/details/86487117" target="_blank" rel="noopener noreferrer">浏览器与Node的事件循环(Event Loop)有何区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>浏览器和 Node 环境下，microtask 任务队列的执行时机不同</p> <ul><li>Node 端，microtask 在事件循环的各个阶段之间执行</li> <li>浏览器端，microtask 在事件循环的 macrotask 执行完之后执行</li></ul> <h2 id="_7-如何在保证页面运行流畅的情况下处理海量数据"><a href="#_7-如何在保证页面运行流畅的情况下处理海量数据" aria-hidden="true" class="header-anchor">#</a> 7.如何在保证页面运行流畅的情况下处理海量数据</h2> <p>大致的执行流程是：</p> <ol><li>用ajax获取到需要处理的数据， 共13万条</li> <li>将数组分组，每组500条，一共260组</li> <li>循环这260组数据，分别处理每一组数据， 利用setTimeout函数开启一个新的执行线程（异步），防止主线程因渲染大量数据导致阻塞。</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/3/2020, 9:23:15 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Prebook/JavaScript/作用域和闭包.html" class="prev">
          作用域和闭包
        </a></span> <span class="next"><a href="/Prebook/JavaScript/语法和API.html">
          语法和API
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Prebook/assets/js/app.9e47b049.js" defer></script><script src="/Prebook/assets/js/2.7ad09ebd.js" defer></script><script src="/Prebook/assets/js/23.0a852139.js" defer></script>
  </body>
</html>
